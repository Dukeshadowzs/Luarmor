local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = game.Players.LocalPlayer:GetMouse()
local CamlockState = false
local Prediction = 0.15634

-- Function to create rainbow ESP chams
local function createCham(target)
    local highlight = Instance.new("Highlight")
    highlight.Parent = target
    highlight.Adornee = target
    highlight.FillColor = Color3.new(1, 0, 0) -- Start with red color
    highlight.FillTransparency = 0.5
    highlight.OutlineColor = Color3.new(1, 0, 0)
    highlight.OutlineTransparency = 0

    local hue = 0
    local hueIncrement = 1 / 60 -- Adjust for faster or slower transitions

    -- Update the color to create a rainbow effect
    RunService.Heartbeat:Connect(function()
        hue = (hue + hueIncrement) % 1
        local color = Color3.fromHSV(hue, 1, 1)
        highlight.FillColor = color
        highlight.OutlineColor = color
    end)

    return highlight
end

-- Function to remove ESP chams
local function removeCham(cham)
    if cham then
        cham:Destroy()
    end
end

local currentCham

function FindNearestEnemy()
    local ClosestDistance, ClosestPlayer = math.huge, nil
    local CenterPosition =
        Vector2.new(
        game:GetService("GuiService"):GetScreenResolution().X / 2,
        game:GetService("GuiService"):GetScreenResolution().Y / 2
    )

    for _, Player in ipairs(game:GetService("Players"):GetPlayers()) do
        if Player ~= LocalPlayer then
            local Character = Player.Character
            if Character and Character:FindFirstChild("HumanoidRootPart") and Character.Humanoid.Health > 0 then
                local Position, IsVisibleOnViewport =
                    game:GetService("Workspace").CurrentCamera:WorldToViewportPoint(Character.HumanoidRootPart.Position)

                if IsVisibleOnViewport then
                    local Distance = (CenterPosition - Vector2.new(Position.X, Position.Y)).Magnitude
                    if Distance < ClosestDistance then
                        ClosestPlayer = Character.HumanoidRootPart
                        ClosestDistance = Distance
                    end
                end
            end
        end
    end

    return ClosestPlayer
end

local enemy = nil

-- Function to aim the camera at the nearest enemy's HumanoidRootPart
RunService.Heartbeat:Connect(function()
    if CamlockState == true then
        if enemy then
            local camera = workspace.CurrentCamera
            camera.CFrame = CFrame.new(camera.CFrame.p, enemy.Position + enemy.Velocity * Prediction)
        end
    end
end)

local gui = Instance.new("ScreenGui")
gui.Name = "Dukeshadow"
gui.Parent = game.CoreGui

local TextButton = Instance.new("TextButton")
TextButton.Text = "DsV2 CamLock"
TextButton.TextSize = 24
TextButton.TextColor3 = Color3.new(1, 1, 1)
TextButton.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1) -- Dark shade of black
TextButton.BorderColor3 = Color3.new(0.3, 0.3, 0.3) -- Slightly lighter shade of black
TextButton.BorderSizePixel = 4
TextButton.Font = Enum.Font.Code
TextButton.Size = UDim2.new(0.2, 0, 0.2, 0)
TextButton.Position = UDim2.new(0, 0, 0.5, 0)
local state = true

TextButton.MouseButton1Click:Connect(function()
    state = not state
    if not state then
        TextButton.Text = "DsV2 ON"
        CamlockState = true
        enemy = FindNearestEnemy()
        if enemy then
            currentCham = createCham(enemy.Parent)
        end
    else
        TextButton.Text = "DsV2 OFF"
        CamlockState = false
        if currentCham then
            removeCham(currentCham)
            currentCham = nil
        end
        enemy = nil
    end
end)
TextButton.Parent = gui
TextButton.Draggable = true

local cornerUI = Instance.new("UICorner")
cornerUI.CornerRadius = UDim.new(0, 5)
cornerUI.Parent = TextButton

local uiStroke = Instance.new("UIStroke")
uiStroke.Color = Color3.new(0.05, 0.05, 0.05) -- Slightly lighter shade of black for stroke
uiStroke.Thickness = 2
uiStroke.Parent = TextButton

-- Keep the button's color in shades of black
RunService.Heartbeat:Connect(function()
    local hue = tick() % 5 / 5
    local shade = 0.1 + (math.sin(hue * math.pi * 2) * 0.05)
    TextButton.BackgroundColor3 = Color3.new(shade, shade, shade)
end)
